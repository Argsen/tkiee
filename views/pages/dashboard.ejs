<script type="text/javascript" src="/js/jquery-2.1.1.js"></script>
<script type="text/javascript" src="/js/jquery-ui-1.11.2.js"></script>
<script type="text/javascript" src="/js/jquery.dialogextend.js"></script>
<script type="text/javascript" src="/js/jssor.core.js"></script>
<script type="text/javascript" src="/js/jssor.utils.js"></script>
<script type="text/javascript" src="/js/jssor.slider.js"></script>
<script type="text/javascript" src="/js/Chart.js"></script>
<script type="text/javascript" src="/js/FileSaver.js"></script>
<script type="text/javascript" src="/js/jquery.jplayer.min.js"></script>
<script type="text/javascript" src="/js/jplayer.playlist.min.js"></script>
<link rel="stylesheet" type="text/css" href="/styles/jquery-ui-1.11.2.css">
<link rel="stylesheet" type="text/css" href="/styles/commonSettings.css">
<link rel="stylesheet" type="text/css" href="/styles/dashboard.css">

<style type="text/css">

</style>


<div class="main">
    <div class="ui-widget-header ui-corner-all" id="controlBar">
        <button id="showHideControlItem"></button>
        <button id="controlItemScrollLeft" style="display: none;"></button>
        <div></div>
        <button id="controlItemScrollRight" style="display: none;"></button>
        <button id="showHideInteractivityItem"></button>
    </div>

    <div>
        <div id = "slider1_container" style = "position: relative; text-align: center;
                top: 0px; margin-left: auto; margin-right: auto; width: 1500px; height: 1125px;">
            <!-- Loading Screen -->
            <div u="loading" style="position: absolute; top: 0px; left: 0px;">
                <div style="filter: alpha(opacity=70); opacity:0.7; position: absolute; display: block;
                        background-color: #000000; top: 0px; left: 0px;width: 100%;height:100%;">
                </div>
                <div style="position: absolute; display: block; background: url(/js/img/loading.gif) no-repeat center center;
                        top: 0px; left: 0px;width: 100%;height:100%;">
                </div>
            </div>

            <!-- Slides Container -->
            <div u="slides" class="slides" style="cursor: move; position: absolute; text-align:center; left: 110px; top: 0px; width: 1500px; height: 1125px;
                    overflow: hidden;">
                <% 	for (var i = 0; i < req.session.sSlidesInfo.pages ; i ++) { %>
                <div class="slideImgArea"><img class="slideImg" u="image" src2="http://<%= req.session.sSlidesInfo.files[i] %>" border="0" style="top: 0px; left: 0px; -webkit-transform: perspective(2000px); position: absolute;" /></div>
                <%	}%>
            </div>
            
            <!-- Arrow Navigator Skin Begin -->
            <style>
                /* jssor slider arrow navigator skin 05 css */
                /*
                .jssora05l              (normal)
                .jssora05r              (normal)
                .jssora05l:hover        (normal mouseover)
                .jssora05r:hover        (normal mouseover)
                .jssora05ldn            (mousedown)
                .jssora05rdn            (mousedown)
                */
                .jssora05l, .jssora05r, .jssora05ldn, .jssora05rdn
                {
                    position: absolute;
                    cursor: pointer;
                    display: block;
                    background: url(/js/img/a11.png) no-repeat;
                    overflow:hidden;
                }
                .jssora05l { background-position: -10px -40px; }
                .jssora05r { background-position: -70px -40px; }
                .jssora05l:hover { background-position: -130px -40px; }
                .jssora05r:hover { background-position: -190px -40px; }
                .jssora05ldn { background-position: -250px -40px; }
                .jssora05rdn { background-position: -310px -40px; }
            </style>
            <!-- Arrow Left -->
            <span u="arrowleft" class="jssora05l" style="width: 40px; height: 40px; top: 123px; left: 118px;">
            </span>
            <!-- Arrow Right -->
            <span u="arrowright" class="jssora05r" style="width: 40px; height: 40px; top: 123px; right: 8px">
            </span>
            <!-- Arrow Navigator Skin End -->                       

            <!-- Bullet Navigator Skin Begin -->
            <style>
                /* jssor slider bullet navigator skin 03 css */
                /*
                .jssorb03 div           (normal)
                .jssorb03 div:hover     (normal mouseover)
                .jssorb03 .av           (active)
                .jssorb03 .av:hover     (active mouseover)
                .jssorb03 .dn           (mousedown)
                */
                .jssorb03 div, .jssorb03 div:hover, .jssorb03 .av
                {
                    background: url(/js/img/b03.png) no-repeat;
                    overflow:hidden;
                    cursor: pointer;
                }
                .jssorb03 div { background-position: -5px -4px; }
                .jssorb03 div:hover, .jssorb03 .av:hover { background-position: -35px -4px; }
                .jssorb03 .av { background-position: -65px -4px; }
                .jssorb03 .dn, .jssorb03 .dn:hover { background-position: -95px -4px; }
            </style>
            
            <!-- bullet navigator container -->
            <div u="navigator" class="jssorb03" style="position: absolute; bottom: 4px; left: 6px;">
                <!-- bullet navigator item prototype -->
                <div u="prototype" style="position: absolute; width: 21px; height: 21px;
                        text-align:center; line-height:21px; color:white; font-size:12px;"><NumberTemplate></NumberTemplate></div>
            </div>

            <!-- Thumbnail Navigator Skin 02 Begin -->
            <div u="thumbnavigator" class="jssort02" style="position: absolute; width: 100px; height: 504px; left:0px; top: 0px;">
            
                <!-- Thumbnail Item Skin Begin -->
                <style>
                    /* jssor slider thumbnail navigator skin 02 css */
                    /*
                    .jssort02 .p            (normal)
                    .jssort02 .p:hover      (normal mouseover)
                    .jssort02 .pav          (active)
                    .jssort02 .pav:hover    (active mouseover)
                    .jssort02 .pdn          (mousedown)
                    */
                    .jssort02 .w
                    {
                        position: absolute;
                        top: 0px;
                        left: 0px;
                        width: 100%;
                        height: 100%;
                    }
                    .jssort02 .c
                    {
                        position: absolute;
                        top: 0px;
                        left: 0px;
                        width: 95px;
                        height: 62px;
                        border: #000 2px solid;
                    }
                    .jssort02 .p:hover .c, .jssort02 .pav:hover .c, .jssort02 .pav .c 
                    {
                        background: url(/js/img/t01.png) center center;
                        border-width: 0px;
                        top: 2px;
                        left: 2px;
                        width: 95px;
                        height: 62px;
                    }
                    .jssort02 .p:hover .c, .jssort02 .pav:hover .c
                    {
                        top: 0px;
                        left: 0px;
                        width: 97px;
                        height: 64px;
                        border: #fff 1px solid;
                    }
                </style>
                <div u="slides" style="cursor: move;">
                    <div u="prototype" class="p" style="position: absolute; width: 99px; height: 66px; top: 0; left: 0;">
                        <div class=w><thumbnailtemplate style=" width: 100%; height: 100%; border: none;position:absolute; top: 0; left: 0;"></thumbnailtemplate></div>
                        <div class=c>
                        </div>
                    </div>
                </div>
                <!-- Thumbnail Item Skin End -->
                
                <!-- Arrow Navigator Skin Begin -->
                <style>
                .jssorb08l, .jssorb08r, .jssorb08ldn, .jssorb08rdn
                {
                    position: absolute;
                    cursor: pointer;
                    display: block;
                    background: url(/js/img/a08.png) no-repeat;
                    overflow:hidden;
                    opacity: .4; filter:alpha(opacity=40);
                }
                .jssorb08l { background-position: -5px -35px; }
                .jssorb08r { background-position: -65px -35px; }
                .jssorb08l:hover { background-position: -5px -35px; opacity: .8; filter:alpha(opacity=80); }
                .jssorb08r:hover { background-position: -65px -35px; opacity: .8; filter:alpha(opacity=80); }
                .jssorb08ldn { background-position: -5px -35px; opacity: .3; filter:alpha(opacity=30); }
                .jssorb08rdn { background-position: -65px -35px; opacity: .3; filter:alpha(opacity=30); }
                </style>
                <!-- Arrow Left -->
            <span u="arrowleft" class="jssorb08l" style="width: 50px; height: 50px; top: 8px; left: 8px;">
            </span>
            <!-- Arrow Right -->
            <span u="arrowright" class="jssorb08r" style="width: 50px; height: 50px; bottom: 8px; left: 8px">
            </span>
                <!-- Arrow Navigator Skin End -->            
            </div>
            <!-- Thumbnail Navigator Skin End -->
        </div>
    </div>
    
    <div id="displayArea" style="position: absolute; display: none; overflow: auto; ">
        
    </div>
    
    <div id="controlArea">
        <div class="ui-widget-header ui-corner-all" id="interactivityBar"></div>
    </div>    
</div>

<div class="ui-widget" id="connectionAlert" style="position: absolute; right: 10px; bottom: 10px; zIndex: 9999; width: 300px; display: none;">
	<div class="ui-state-error ui-corner-all" style="padding: 0 .7em;">
		<p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>
		<strong>Alert:</strong> Connection to server failure. Reconnecting...</p>
	</div>
</div>


<script>
    $.ajaxSetup({
        cache: false
    });
    
    //-------------------------------------------
    // Get Default Info below
    //-------------------------------------------      
    
    var pageData = {
        "session": {
            "totalPage": '<%= req.session.sSlidesInfo.pages %>' == 'undefined' ? '0' : '<%= req.session.sSlidesInfo.pages %>',
            "sessionId": '<%= req.session.sSessionId %>' == 'undefined' ? '0' : '<%= req.session.sSessionId %>',
            "sessionName": '<%= req.session.sSessionName %>' == 'undefined' ? '0' : '<%= req.session.sSessionName %>',
            "sessionKey": '<%= req.session.sKeyPhase %>' == 'undefined' ? '0' : '<%= req.session.sKeyPhase %>',
            "role": '<%= req.session.sRole %>' == 'undefined' ? '0' : '<%= req.session.sRole %>',
            "userId": '<%= req.session.sUserId %>' == 'undefined' ? '0' : '<%= req.session.sUserId %>',
            "currentPage": 1,
            "currentFileName": "",
            "currentFileId": 0,
            "currentFilePage": 1,
            "currentParticipant": 0,
            "maxParticipant": 0
        },
        "page": {
            "id": [],
            "image": []
        },
        "user": {
            "id": '<%= req.session.sUserId %>' == 'undefined' ? '0' : '<%= req.session.sUserId %>',
            "preference": {}
        },
        "quiz": "",
        "evaluation": ""
    };

    <% for (var i=0; i < req.session.sSlidesInfo.pages; i++) { %>
        pageData.page.image[<%= i %>]="http://<%= req.session.sSlidesInfo.files[i] %>";
    <%	} %>

    <% 	for (var i = 0; i < req.session.sSlidesInfo.pages ; i ++) { %>
        pageData.page.id.push("<%= req.session.sSlidesInfo.pngId[i] %>")
    <% } %>
    
    pageData.user.preference.control = [
        {name: "BacktoLogin", text: "Home", icon: "ui-icon-home"},
        {name: "Display", text: "Display", icon: "ui-icon-image"}
    ];
    
    if (pageData.session.role == 'participant') {
        pageData.user.preference.interactivity = [
            {name: "Resources", text: "Resources", icon: "/styles/icons/reference.png"}
        ]
    } else {
        pageData.user.preference.interactivity = [
        //    {name: "Feedback", text: "Feedback", icon: "/styles/icons/feedback.png"},
        //    {name: "Question", text: "Question", icon: "/styles/icons/question.png"},
        //    {name: "Quiz", text: "Quiz", icon: "/styles/icons/quiz.png"},
        //    {name: "Evaluation", text: "Evaluation", icon: "/styles/icons/evaluation.png"},
        //    {name: "SlideTag", text: "SlideTag", icon: "/styles/icons/slidetag.png"},
        //    {name: "Reference", text: "Reference", icon: "/styles/icons/reference.png"},
        //    {name: "Distraction", text: "Distraction", icon: "/styles/icons/reference.png"},
            {name: "Resources", text: "Resources", icon: "/styles/icons/reference.png"},
        ];
    }    
    
    $.ajax({
		type: "GET",
		url: "quiz/list",
		dataType: "json",
		cache: false,
		data: {"sessionId": pageData.session.sessionId},
		success: function(response) {
            pageData.quiz = response;
            scripts.fetch();
        }
    });

    //-------------------------------------------
    // Load .js below
    //-------------------------------------------
    
    function getScripts( scripts, onScript, onComplete ) {
        this.async = true;
        this.cache = false;
        this.data = null;
        this.complete = function () { $.scriptHandler.loaded(); };
        this.scripts = scripts;
        this.onScript = onScript;
        this.onComplete = onComplete;
        this.total = scripts.length;
        this.progress = 0;
    };

    getScripts.prototype.fetch = function() {
        $.scriptHandler = this;
        var src = this.scripts[ this.progress ];
        console.log('%cFetching %s','color:#ffbc2e;', src);

        $.ajax({
            crossDomain:true,
            async:this.async,
            cache:this.cache,
            type:'GET',
            url: src,
            data:this.data,
            statusCode: {
                200: this.complete
            },
            dataType:'script'
        });
    };

    getScripts.prototype.loaded = function () {
        this.progress++;
        if( this.progress >= this.total ) {
            if(this.onComplete) this.onComplete();
        } else {
            this.fetch();
        };
        if(this.onScript) this.onScript();
    };
    
    var scripts = new getScripts(
        ["/js/UI - Dashboard.js", "/js/dashboard.js"],
        function() {
            /* Optional - Executed each time a script has loaded (Use for Progress updates?) */
        },
        function () {
            /* Optional - Executed when the entire list of scripts has been loaded */
        }
    );       
    
    //-------------------------------------------
    // Page Settings below
    //-------------------------------------------     
 
    $(document).ready(function () {    
       
    });
</script>